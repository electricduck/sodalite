name: Build
inputs:
  container_image:
    required: false
    type: string
  dry_run:
    required: false
    type: boolean
  tree:
    required: true
    type: string
runs:
  using: "composite"
  steps:
      - run: |
          function test_input() {
              if [[ "$1" != "" ]]; then
                  echo "$1"
              else
                  echo "$2"
              fi
          }
          ./build.sh \
            --container \
            --tree "${{ inputs.tree }}" \
            --vendor "sodaliterocks" \
            --working-dir "/srv/store/variable/ostree" \
            --ex-container-hostname "$(hostname -f)" \
            --ex-container-image "$(test_input "${{ inputs.container_image }}" "fedora:37")" \
            --ex-override-starttime "$(date +%s)" \
            --ex-print-github-release-table-row
        shell: bash
